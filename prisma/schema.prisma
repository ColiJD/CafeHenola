generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model roles {
  roleId    Int      @id @default(autoincrement())
  roleName  String   @unique(map: "roleName") @db.VarChar(50)
  createdAt DateTime @default(now()) @db.DateTime(0)
  users     users[]
}

model users {
  userId          Int               @id @default(autoincrement())
  userEmail       String            @unique(map: "userEmail") @db.VarChar(255)
  userPassword    String            @db.VarChar(255)
  userName        String?           @db.VarChar(100)
  roleId          Int
  createdAt       DateTime          @default(now()) @db.DateTime(0)
  password_resets password_resets[]
  roles           roles             @relation(fields: [roleId], references: [roleId], onDelete: NoAction, onUpdate: NoAction, map: "users_ibfk_1")

  @@index([roleId], map: "roleId")
}

model password_resets {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  userId    Int
  token     String   @unique(map: "idx_token") @db.VarChar(64)
  expiresAt DateTime @db.DateTime(0)
  createdAt DateTime @default(now()) @db.DateTime(0)
  users     users    @relation(fields: [userId], references: [userId], onDelete: Cascade, onUpdate: NoAction, map: "password_resets_ibfk_1")

  @@index([userId], map: "userId")
}

model compradores {
  compradorId        Int      @id @default(autoincrement())
  compradorNombre    String   @db.VarChar(255)
  compradorRTN       String?  @unique(map: "compradorRTN") @db.VarChar(50)
  compradorDireccion String?  @db.VarChar(300)
  compradorTelefono  String   @db.VarChar(50)
  compradorEmail     String   @db.VarChar(255)
  createdAt          DateTime @default(now()) @db.DateTime(0)
  Compra             Compra[]
}

model CierreContrato {
  cierreID         Int       @id @default(autoincrement())
  contratoID       Int
  fechaCierre      DateTime? @default(now()) @db.DateTime(0)
  totalEntregadoQQ Decimal   @db.Decimal(15, 2)
  totalLps         Decimal   @db.Decimal(15, 2)
  tipoMovimiento   String    @default("Entrada") @db.VarChar(50)
  observaciones    String?   @db.VarChar(200)
  Contrato         Contrato  @relation(fields: [contratoID], references: [contratoID], onDelete: NoAction, onUpdate: NoAction, map: "CierreContrato_ibfk_1")

  @@index([contratoID], map: "contratoID")
}

model Cliente {
  clienteID          Int                 @id @default(autoincrement())
  clienteCedula      String?             @unique(map: "clienteCedula") @db.VarChar(15)
  clienteNombre      String?             @db.VarChar(20)
  clienteApellido    String?             @db.VarChar(20)
  clienteDirecion    String?             @db.VarChar(200)
  clienteMunicipio   String?             @db.VarChar(30)
  clienteDepartament String?             @db.VarChar(30)
  claveIHCAFE        String?             @db.VarChar(30)
  clienteTelefono    String?             @db.VarChar(30)
  clienteRTN         String?             @db.VarChar(17)
  Compra             Compra[]
  Contrato           Contrato[]
  Deposito           Deposito[]
  InventarioCliente  InventarioCliente[]
  LiqDeposito        LiqDeposito[]
}

model Compra {
  compraId            Int          @id @default(autoincrement())
  clienteID           Int?
  compradorID         Int?
  compraFecha         DateTime?    @db.DateTime(0)
  compraTipoDocumento String?      @db.VarChar(20)
  compraMovimiento    String?      @db.VarChar(20)
  compraTipoCafe      Int?
  compraPrecioQQ      Decimal?     @db.Decimal(15, 2)
  compraCantidadQQ    Decimal?     @db.Decimal(15, 2)
  compraTotal         Decimal?     @db.Decimal(15, 2)
  compraTotalSacos    Decimal?     @db.Decimal(15, 2)
  compraRetencio      Decimal?     @db.Decimal(15, 2)
  compraEn            String?      @db.VarChar(20)
  compraDescripcion   String?      @db.VarChar(200)
  Cliente             Cliente?     @relation(fields: [clienteID], references: [clienteID], onDelete: NoAction, onUpdate: NoAction, map: "Compra_ibfk_1")
  Producto            Producto?    @relation(fields: [compraTipoCafe], references: [productID], onDelete: NoAction, onUpdate: NoAction, map: "Compra_ibfk_2")
  compradores         compradores? @relation(fields: [compradorID], references: [compradorId], onDelete: NoAction, onUpdate: NoAction, map: "fk_comprador")

  @@index([clienteID], map: "clienteID")
  @@index([compraTipoCafe], map: "compraTipoCafe")
  @@index([compradorID], map: "fk_comprador")
}

model Contrato {
  contratoID          Int               @id @default(autoincrement())
  contratoclienteID   Int?
  contratoFecha       DateTime?         @db.DateTime(0)
  contratoMovimiento  String?           @db.VarChar(20)
  contratoTipoCafe    Int?
  contratoPrecio      Decimal?          @db.Decimal(15, 2)
  contratoCantidadQQ  Decimal?          @db.Decimal(15, 2)
  contratoRetencionQQ Decimal?          @db.Decimal(15, 2)
  contratoTotalLps    Decimal?          @db.Decimal(15, 2)
  contratoEn          String?           @db.VarChar(20)
  contratoDescripcion String?           @db.VarChar(200)
  estado              String?           @default("Pendiente") @db.VarChar(20)
  CierreContrato      CierreContrato[]
  Cliente             Cliente?          @relation(fields: [contratoclienteID], references: [clienteID], onDelete: NoAction, onUpdate: NoAction, map: "Contrato_ibfk_1")
  Producto            Producto?         @relation(fields: [contratoTipoCafe], references: [productID], onDelete: NoAction, onUpdate: NoAction, map: "Contrato_ibfk_2")
  Deposito            Deposito[]
  DetalleContrato     DetalleContrato[]

  @@index([contratoTipoCafe], map: "contratoTipoCafe")
  @@index([contratoclienteID], map: "contratoclienteID")
}

model Deposito {
  depositoID          Int                  @id @default(autoincrement())
  depositoFecha       DateTime?            @db.DateTime(0)
  clienteID           Int
  depositoTipoCafe    Int
  contratoID          Int?
  depositoMovimiento  String?              @db.VarChar(20)
  depositoCantidadQQ  Decimal?             @db.Decimal(15, 2)
  depositoTotalSacos  Decimal?             @db.Decimal(15, 2)
  depositoRetencionQQ Decimal?             @db.Decimal(15, 2)
  depositoEn          String?              @db.VarChar(20)
  depositoDescripcion String?              @db.VarChar(200)
  estado              String?              @default("Pendiente") @db.VarChar(20)
  Cliente             Cliente              @relation(fields: [clienteID], references: [clienteID], onDelete: NoAction, onUpdate: NoAction, map: "Deposito_ibfk_1")
  Producto            Producto             @relation(fields: [depositoTipoCafe], references: [productID], onDelete: NoAction, onUpdate: NoAction, map: "Deposito_ibfk_2")
  Contrato            Contrato?            @relation(fields: [contratoID], references: [contratoID], onDelete: NoAction, onUpdate: NoAction, map: "Deposito_ibfk_3")
  DetalleLiqDeposito  DetalleLiqDeposito[]

  @@index([clienteID], map: "clienteID")
  @@index([contratoID], map: "contratoID")
  @@index([depositoTipoCafe], map: "depositoTipoCafe")
}

model DetalleContrato {
  detalleID      Int       @id @default(autoincrement())
  contratoID     Int
  cantidadQQ     Decimal   @db.Decimal(15, 2)
  precioQQ       Decimal   @db.Decimal(15, 2)
  tipoMovimiento String    @default("Entrada") @db.VarChar(50)
  fecha          DateTime? @default(now()) @db.DateTime(0)
  observaciones  String?   @db.VarChar(200)
  Contrato       Contrato  @relation(fields: [contratoID], references: [contratoID], onDelete: NoAction, onUpdate: NoAction, map: "DetalleContrato_ibfk_1")

  @@index([contratoID], map: "contratoID")
}

model DetalleLiqDeposito {
  id          Int          @id @default(autoincrement())
  liqID       Int?
  depositoID  Int?
  cantidadQQ  Decimal?     @db.Decimal(15, 2)
  precio      Decimal?     @db.Decimal(15, 2)
  totalLps    Decimal?     @db.Decimal(15, 2)
  LiqDeposito LiqDeposito? @relation(fields: [liqID], references: [liqID], onDelete: NoAction, onUpdate: NoAction, map: "DetalleLiqDeposito_ibfk_1")
  Deposito    Deposito?    @relation(fields: [depositoID], references: [depositoID], onDelete: NoAction, onUpdate: NoAction, map: "DetalleLiqDeposito_ibfk_2")

  @@index([depositoID], map: "depositoID")
  @@index([liqID], map: "liqID")
}

model InventarioCliente {
  inventarioClienteID  Int                    @id @default(autoincrement())
  clienteID            Int
  compradorID          Int?
  productoID           Int
  cantidadQQ           Decimal                @default(0.00) @db.Decimal(15, 2)
  cantidadSacos        Decimal                @default(0.00) @db.Decimal(15, 2)
  Cliente              Cliente                @relation(fields: [clienteID], references: [clienteID], onDelete: NoAction, onUpdate: NoAction, map: "InventarioCliente_ibfk_1")
  Producto             Producto               @relation(fields: [productoID], references: [productID], onDelete: NoAction, onUpdate: NoAction, map: "InventarioCliente_ibfk_2")
  MovimientoInventario MovimientoInventario[]

  @@unique([clienteID, productoID], map: "uq_cliente_producto")
  @@index([productoID], map: "productoID")
}

model LiqDeposito {
  liqID              Int                  @id @default(autoincrement())
  liqFecha           DateTime?            @db.DateTime(0)
  liqclienteID       Int?
  liqTipoDocumento   String?              @db.VarChar(20)
  liqMovimiento      String?              @db.VarChar(20)
  liqTipoCafe        Int?
  liqPrecio          Decimal?             @db.Decimal(15, 2)
  liqCatidadQQ       Decimal?             @db.Decimal(15, 2)
  liqTotalLps        Decimal?             @db.Decimal(15, 2)
  liqEn              String?              @db.VarChar(20)
  liqDescripcion     String?              @db.VarChar(200)
  DetalleLiqDeposito DetalleLiqDeposito[]
  Cliente            Cliente?             @relation(fields: [liqclienteID], references: [clienteID], onDelete: NoAction, onUpdate: NoAction, map: "LiqDeposito_ibfk_1")
  Producto           Producto?            @relation(fields: [liqTipoCafe], references: [productID], onDelete: NoAction, onUpdate: NoAction, map: "LiqDeposito_ibfk_2")

  @@index([liqTipoCafe], map: "liqTipoCafe")
  @@index([liqclienteID], map: "liqclienteID")
}

model MovimientoInventario {
  movimientoID        Int                                 @id @default(autoincrement())
  inventarioClienteID Int
  fecha               DateTime                            @default(now()) @db.DateTime(0)
  tipoMovimiento      MovimientoInventario_tipoMovimiento
  referenciaTipo      String?                             @db.VarChar(50)
  referenciaID        Int?
  cantidadQQ          Decimal                             @db.Decimal(15, 2)
  cantidadSacos       Decimal                             @default(0.00) @db.Decimal(15, 2)
  nota                String?                             @db.VarChar(200)
  InventarioCliente   InventarioCliente                   @relation(fields: [inventarioClienteID], references: [inventarioClienteID], onDelete: NoAction, onUpdate: NoAction, map: "MovimientoInventario_ibfk_1")

  @@index([inventarioClienteID], map: "inventarioClienteID")
}

model Producto {
  productID         Int                 @id @default(autoincrement())
  productName       String              @unique(map: "productName") @db.VarChar(50)
  tara              Decimal?            @default(0.00) @db.Decimal(5, 2)
  descuento         Decimal?            @default(0.00) @db.Decimal(5, 2)
  factorOro         Decimal?            @default(1.00) @db.Decimal(10, 2)
  Compra            Compra[]
  Contrato          Contrato[]
  Deposito          Deposito[]
  InventarioCliente InventarioCliente[]
  LiqDeposito       LiqDeposito[]
}

enum MovimientoInventario_tipoMovimiento {
  Entrada
  Salida
}
